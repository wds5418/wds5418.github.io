<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="1.工具篇1.1Cobalt Strike及其二开Cobalt Strike 是一款基于java语言开发的渗透测试神器，常被业界人称为CS神器。（webshell管理、shellcode的生成、钓鱼网站生成、多人团队攻击侧服务器搭建，总之功能非常多） 官方网站: 1https:&#x2F;&#x2F;www.cobaltstrike.com&#x2F;  官方文档： 1https:&#x2F;&#x2F;hstechdocs.helpsystem">
<meta property="og:type" content="article">
<meta property="og:title" content="关于木马免杀">
<meta property="og:url" content="http://example.com/2024/03/28/%E5%85%B3%E4%BA%8E%E6%9C%A8%E9%A9%AC%E5%85%8D%E6%9D%80/index.html">
<meta property="og:site_name" content="wds&#39;s 学习博客">
<meta property="og:description" content="1.工具篇1.1Cobalt Strike及其二开Cobalt Strike 是一款基于java语言开发的渗透测试神器，常被业界人称为CS神器。（webshell管理、shellcode的生成、钓鱼网站生成、多人团队攻击侧服务器搭建，总之功能非常多） 官方网站: 1https:&#x2F;&#x2F;www.cobaltstrike.com&#x2F;  官方文档： 1https:&#x2F;&#x2F;hstechdocs.helpsystem">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/uploads/profilecheck.png">
<meta property="og:image" content="http://example.com/uploads/1.png">
<meta property="article:published_time" content="2024-03-27T23:41:01.000Z">
<meta property="article:modified_time" content="2025-07-28T04:52:44.273Z">
<meta property="article:author" content="wang deshan">
<meta property="article:tag" content="免杀">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/uploads/profilecheck.png">


<link rel="canonical" href="http://example.com/2024/03/28/%E5%85%B3%E4%BA%8E%E6%9C%A8%E9%A9%AC%E5%85%8D%E6%9D%80/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2024/03/28/%E5%85%B3%E4%BA%8E%E6%9C%A8%E9%A9%AC%E5%85%8D%E6%9D%80/","path":"2024/03/28/关于木马免杀/","title":"关于木马免杀"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>关于木马免杀 | wds's 学习博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="wds's 学习博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">wds's 学习博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">个人势学习分享网站，闲记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E5%B7%A5%E5%85%B7%E7%AF%87"><span class="nav-number">1.</span> <span class="nav-text">1.工具篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1Cobalt-Strike%E5%8F%8A%E5%85%B6%E4%BA%8C%E5%BC%80"><span class="nav-number">1.1.</span> <span class="nav-text">1.1Cobalt Strike及其二开</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#profile%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.1.</span> <span class="nav-text">profile文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"><span class="nav-number">1.1.2.</span> <span class="nav-text">修改默认服务端口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9ssl%E8%AF%81%E4%B9%A6"><span class="nav-number">1.1.3.</span> <span class="nav-text">修改ssl证书</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CrossC2%E6%8F%92%E4%BB%B6"><span class="nav-number">1.1.4.</span> <span class="nav-text">CrossC2插件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2sgn%E7%BC%96%E7%A0%81%E5%99%A8"><span class="nav-number">1.2.</span> <span class="nav-text">1.2sgn编码器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3SkyShadow"><span class="nav-number">1.3.</span> <span class="nav-text">1.3SkyShadow</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4ZeroEye"><span class="nav-number">1.4.</span> <span class="nav-text">1.4ZeroEye</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E5%85%8D%E6%9D%80%E6%89%8B%E6%B3%95%EF%BC%88%E9%AA%9A%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="nav-number">2.</span> <span class="nav-text">2.免杀手法（骚操作）</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wang deshan"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">wang deshan</p>
  <div class="site-description" itemprop="description">ctf/python/c++</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>



<div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/28/%E5%85%B3%E4%BA%8E%E6%9C%A8%E9%A9%AC%E5%85%8D%E6%9D%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="wang deshan">
      <meta itemprop="description" content="ctf/python/c++">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wds's 学习博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          关于木马免杀
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-03-28 07:41:01" itemprop="dateCreated datePublished" datetime="2024-03-28T07:41:01+08:00">2024-03-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2025-07-28 12:52:44" itemprop="dateModified" datetime="2025-07-28T12:52:44+08:00">2025-07-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%85%8D%E6%9D%80/" itemprop="url" rel="index"><span itemprop="name">免杀</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="1-工具篇"><a href="#1-工具篇" class="headerlink" title="1.工具篇"></a>1.工具篇</h1><h2 id="1-1Cobalt-Strike及其二开"><a href="#1-1Cobalt-Strike及其二开" class="headerlink" title="1.1Cobalt Strike及其二开"></a>1.1Cobalt Strike及其二开</h2><p>Cobalt Strike 是一款基于java语言开发的渗透测试神器，常被业界人称为CS神器。（webshell管理、shellcode的生成、钓鱼网站生成、多人团队攻击侧服务器搭建，总之功能非常多）</p>
<p>官方网站:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cobaltstrike.com/</span><br></pre></td></tr></table></figure>

<p>官方文档：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/content/topics/welcome_main.htm#_Toc65482705</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>关于cs的二次开发，包括修改profile文件、修改默认的证书、</p>
<p>安装插件 CrossC2-GithubBot-2021-11-02.cna</p>
<p>魔改cs目的是修改其特征防溯源，或是替换模板让其生成的payload直接达到免杀效果，以及添加实用的插件功能。</p>
<p>主要内容包括：</p>
<ul>
<li><p>配置特征消除（50050改成其他端口、修改cs的ssl证书、改profile文件）</p>
</li>
<li><p>上线流量特征消除</p>
</li>
</ul>
<p>采用默认http(s)的CS请求url为4位字符串（如aaa9），将这4位字符串作为传入，通过算法checksum8会得到92(93)，蓝队可以以此判定为CS连接器为了</p>
<p>防止这一点，可以自定义字符串（如xiaodi），通过checksum8得到其值（比如是115），那么再替换CS源码中的92为115即可</p>
<ul>
<li><p>生成payload特征消除</p>
<p>比如对http(s)生成payload做特征消除，用x86资源bin替换x64的，实现x64生成与x86一致，实现生成即免杀（结合之前的免杀技术效果更好）</p>
<p> 对Powershell生成Payload做特征消除，用x86资源ps1替换原本ps1，实现生成即免杀（结合之前的免杀技术效果更好）</p>
</li>
</ul>
<h3 id="profile文件"><a href="#profile文件" class="headerlink" title="profile文件"></a>profile文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">##基本语法</span><br><span class="line"></span><br><span class="line"># this is a comment , # 是注释</span><br><span class="line"># 设置全局变量 , 和其他无关是cs自身的一些机制</span><br><span class="line">set global_option &quot;value&quot;;</span><br><span class="line"># 协议的配置 , 如: http-get , https-post等</span><br><span class="line"></span><br><span class="line"># 代码块</span><br><span class="line">protocol-transaction &#123;</span><br><span class="line">	set local_option &quot;value&quot;;    </span><br><span class="line">	client &#123;</span><br><span class="line">		# customize client indicators     </span><br><span class="line">		&#125;</span><br><span class="line">    server &#123; </span><br><span class="line">    # customize server indicators     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内容基本上是关于set和一些协议上的配置。</p>
<p>下面会以 jquery-c2.4.5-jx.profile 文件为例来解释其中的各个配置项的作用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"># Malleable C2 Profile</span><br><span class="line"># Version: CobaltStrike 4.5</span><br><span class="line"># File: jquery-c2.4.5.profile</span><br><span class="line"># Description: </span><br><span class="line">#   c2 profile attempting to mimic a jquery.js request #   uses signed certificates</span><br><span class="line">#   or self-signed certificates</span><br><span class="line"># Authors: @joevest, @andrewchiles, @001SPARTaN ### Global Option Block</span><br><span class="line"></span><br><span class="line"># 设置全局变量 sample_name , 值是当前文件名</span><br><span class="line">set sample_name &quot;jQuery CS 4.5 Profile&quot;;</span><br><span class="line"># 设置心跳包的时间 , 单位毫秒</span><br><span class="line">set sleeptime &quot;1000&quot;;   # 45 Seconds 1000毫秒==1秒</span><br><span class="line"># set sleeptime &quot;&lt;60000&gt;&quot;; # 1  Minute , 默认的</span><br><span class="line"></span><br><span class="line"># 设置心跳包时间的波动范围 45 +- 45*37% </span><br><span class="line">set jitter &quot;50&quot;;   # % jitter 1 +- 1*50%</span><br><span class="line"></span><br><span class="line"># 意味着每次HTTP服务器响应时，都会附加一个长度在0到100个字符之间的随机字符串。这样做的目的是为了增加服务器响应的大小的不可预测性，使得Cobalt Strike的通信模式更难以通过网络监控工具被识别和分析。</span><br><span class="line">set data_jitter &quot;100&quot;; </span><br><span class="line"></span><br><span class="line"># 设置全局的UA头</span><br><span class="line">set useragent &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36&quot;;</span><br><span class="line"></span><br><span class="line">##https-certificate ssl证书配置</span><br><span class="line"></span><br><span class="line">https-certificate &#123;</span><br><span class="line"></span><br><span class="line">	set C &quot;US&quot;; #国家</span><br><span class="line">	set CN &quot;jquery.com&quot;;</span><br><span class="line">	set O &quot;jQuery&quot;;</span><br><span class="line">	set OU &quot;Certificate Authority&quot;;set validity &quot;365&quot;;</span><br><span class="line">	</span><br><span class="line">	set keystore &quot;cobaltstrike.store&quot;; # 证书文件</span><br><span class="line">	set password &quot;1qazwsx&quot;; # 证书密码</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##SMB和TCP , smb会在横向渗透使用到</span><br><span class="line"></span><br><span class="line">### SMB Beacon </span><br><span class="line">set pipename &quot;mojo.5688.8052.183894939787088877##&quot;;</span><br><span class="line">## smb管道的名字</span><br><span class="line"></span><br><span class="line">set pipename_stager &quot;mojo.5688.8052.35780273329370473##&quot;; </span><br><span class="line"># smb stager管道的名字</span><br><span class="line">set smb_frame_header &quot;\x80&quot;;</span><br><span class="line"></span><br><span class="line">### TCP Beacon 监听端口</span><br><span class="line">set tcp_port &quot;42585&quot;;</span><br><span class="line">set tcp_frame_header &quot;\x80&quot;;</span><br><span class="line"></span><br><span class="line">##DNS beacon , 不经常使用 , 但是对于只有DNS协议出网的设备可以使用</span><br><span class="line"></span><br><span class="line">dns-beacon &#123;</span><br><span class="line"></span><br><span class="line">	set dns_idle   &quot;74.125.196.113&quot;; </span><br><span class="line">	## 第一次dns查询的地址</span><br><span class="line">	set dns_max_txt &quot;252&quot;;</span><br><span class="line">	## 最大查询次数 , 255以下 , 能被4整除</span><br><span class="line">	set dns_sleep &quot;0&quot;; </span><br><span class="line">	## sleep时间	</span><br><span class="line">	set dns_ttl  &quot;5&quot;; </span><br><span class="line">	## ttl值</span><br><span class="line">	set maxdns 	&quot;255&quot;; </span><br><span class="line">	# 最大dns服务转接数量</span><br><span class="line">	set dns_stager_prepend &quot;.resources.123456.&quot;; </span><br><span class="line">	## 使用dns协议的马,pe头追加的内容</span><br><span class="line">	set dns_stager_subhost &quot;.feeds.123456.&quot;; </span><br><span class="line">	## 子域名的查询配置</span><br><span class="line"># DNS subhosts override options, added in version 4.3</span><br><span class="line">	set beacon  &quot;a.bc.&quot;;</span><br><span class="line">	set get_A 	&quot;b.1a.&quot;;</span><br><span class="line">	set get_AAAA &quot;c.4a.&quot;;</span><br><span class="line">	set get_TXT &quot;d.tx.&quot;;</span><br><span class="line">	set put_metadata &quot;e.md.&quot;;</span><br><span class="line">	set put_output &quot;f.po.&quot;;</span><br><span class="line">	set ns_response &quot;zero&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>算了，不水字数了，基本上协议都眼熟，看不懂度娘一下。</p>
<p>profile特征的修改参考以下项目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/threatexpress/malleable-c2</span><br><span class="line">https://github.com/xx0hcd/Malleable-C2-Profiles</span><br><span class="line">https://github.com/Tylous/SourcePoint</span><br><span class="line">https://wbglil.gitbook.io/cobalt-strike/cobalt-strikekuo-zhan/malleable-c2</span><br></pre></td></tr></table></figure>

<p>重写Stager和Beacon参考大牛</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">鸡哥的项目:</span><br><span class="line">https://bbs.pediy.com/thread-269115.htm</span><br><span class="line">https://github.com/mai1zhi2/SharpBeacon/tree/master</span><br><span class="line"></span><br><span class="line">WBGlIl大神的项目</span><br><span class="line">https://xz.aliyun.com/t/9929</span><br><span class="line"></span><br><span class="line">LiHua大佬的</span><br><span class="line">https://github.com/NoOne-hub/Beacon.dll</span><br><span class="line"></span><br><span class="line">go项目</span><br><span class="line">https://github.com/darkr4y/geacon/tree/4.0</span><br></pre></td></tr></table></figure>

<p>最后一定要检查是否可用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod+x c2lint</span><br><span class="line">./c2lint [/path/to/my.profile] </span><br><span class="line"># 如 ./c2lint bing_jx.profile</span><br><span class="line"># 进行各种协议 如 smb , http , https的请求模拟 , 判断是否可用 , 请求结束下面会有结果输出 (黄色警告,红色语法错误)</span><br></pre></td></tr></table></figure>



<p><img src="/uploads/profilecheck.png" alt="图片"></p>
<h3 id="修改默认服务端口"><a href="#修改默认服务端口" class="headerlink" title="修改默认服务端口"></a>修改默认服务端口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim teamserver</span><br><span class="line">##只需要修改最后一行的-Dcobaltstrike.server_port</span><br><span class="line">## ,可以是 80 , 443 , 3389 , 8080, 8443等常见端口 （1-65535）</span><br><span class="line"># start the team server.</span><br><span class="line">java -XX:ParallelGCThreads=4-Dcobaltstrike.server_port=8080-Djavax.net.ssl.keyStore=./cobaltstrike.store -Djavax.net.ssl.keyStorePassword=Microsoft -server-XX:+AggressiveHeap -XX:+UseParallelGC -classpath ./cobaltstrike.jar </span><br><span class="line">server.TeamServer $*</span><br></pre></td></tr></table></figure>



<h3 id="修改ssl证书"><a href="#修改ssl证书" class="headerlink" title="修改ssl证书"></a>修改ssl证书</h3><p>1.购买域名,申请免费的ssl证书</p>
<p>2.修改teamserver证书密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">##查看默认证书</span><br><span class="line">keytool -list-v-keystore cobaltstrike.store</span><br><span class="line">Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true 输入密钥库口令: </span><br><span class="line"># 默认口令是 Microsoft</span><br><span class="line"></span><br><span class="line">##生成伪造证书</span><br><span class="line"></span><br><span class="line"># 原ssl证书文件备份</span><br><span class="line">mv cobaltstrike.store cobaltstrike.store.bak </span><br><span class="line"># 生成证书</span><br><span class="line">keytool -keystore cobaltstrike_new.store -storepass 1qazwsx -keypass 1qazwsx -genkey-keyalg RSA -alias qq.com -dname&quot;CN=US,OU=qq.com,O=Software,L=Somewhere,ST=Cyberspace, C=CN&quot;</span><br><span class="line"># ssl证书重命名</span><br><span class="line">mv cobaltstrike_new.store cobaltstrike.store </span><br><span class="line"></span><br><span class="line">##然后在teamserver中设置即可</span><br><span class="line"></span><br><span class="line">-Djavax.net.ssl.keyStore=./cobaltstrike.store # 注意密码</span><br></pre></td></tr></table></figure>

<p>虽然伪装的证书可以欺骗fofa这类搜索引擎 , 但是毕竟是伪造的 , 使用ssl证书查询工具是查询不到颁发</p>
<p>机构的 , 因为是我们自己生成的, 真正的证书是证书签发机构颁布的 , 腾讯云购买域名就可以免费申请</p>
<p>ssl证书, 不过要实名备案 , 推荐Cloudflare , letsencrypt或各国外云服务提供商不需要实名备案</p>
<h3 id="CrossC2插件"><a href="#CrossC2插件" class="headerlink" title="CrossC2插件"></a>CrossC2插件</h3><p>cs默认是不支持上线linux主机的 , 但是可以通过安装CrossC2插件实现 </p>
<p><strong>因为一些原因，目前强制只支持HTTPS beacon。</strong></p>
<p>下载地址 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/gloxec/CrossC2/releases</span><br></pre></td></tr></table></figure>





<h2 id="1-2sgn编码器"><a href="#1-2sgn编码器" class="headerlink" title="1.2sgn编码器"></a>1.2sgn编码器</h2><p>SGN是一个用于进攻性安全目的的多态二进制编码器，其核心是生成静态不可检测的二进制payloads。该项目基于线性反馈移位寄存器（LFSR）的工作原理，但相比原版，它提供了更多的改进和增强功能，如64位支持、更小的解码器、无明显循环条件的解码过程等。（对cs生成的shellcode进行加密）</p>
<p>github：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/EgeBalci/sgn</span><br></pre></td></tr></table></figure>

<p><img src="/uploads/1.png" alt="图片"></p>
<h2 id="1-3SkyShadow"><a href="#1-3SkyShadow" class="headerlink" title="1.3SkyShadow"></a>1.3SkyShadow</h2><p>从本机获取微软 DLL 列表，并快速生成指定文件夹下所有 EXE 的 Unique DLL Hijacking Payload,用于伪造DLL文件。</p>
<p><strong>白加黑</strong>简单来说就是通过白名单的exe运行来去加载恶意的dll达到shellcode加载的目的，那么就需要利用工具对exe加载的dll进行了解。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Librafeng/SkyShadow</span><br></pre></td></tr></table></figure>



<h2 id="1-4ZeroEye"><a href="#1-4ZeroEye" class="headerlink" title="1.4ZeroEye"></a>1.4ZeroEye</h2><p>用于扫描 EXE 文件的导入表，列出导入的DLL文件，并筛选出非系统DLL，符合条件的文件将被复制到特定的 <strong>binX64</strong> 或 <strong>binX86</strong> 文件夹，并生成 <strong>Infos.txt</strong> 文件记录DLL信息。是和skyshadow一样类型的工具，都是ZeroEye更偏自动化一点，而skyshadow更方便手动制作dll劫持。（后面有时间再补充白加黑的内容）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/ImCoriander/ZeroEye</span><br></pre></td></tr></table></figure>



<h1 id="2-免杀手法（骚操作）"><a href="#2-免杀手法（骚操作）" class="headerlink" title="2.免杀手法（骚操作）"></a>2.免杀手法（骚操作）</h1>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%85%8D%E6%9D%80/" rel="tag"># 免杀</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/04/27/phar%E5%BA%8F%E5%88%97%E5%8C%96%E8%80%83%E9%A2%98%EF%BC%88%E6%9A%82%E5%AD%98%EF%BC%89/" rel="prev" title="phar序列化考题（暂存）">
                  <i class="fa fa-chevron-left"></i> phar序列化考题（暂存）
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/06/30/%E2%80%9C%E8%93%9D%E9%98%9F%E9%98%B2%E5%AE%88%E4%BE%A7%E9%9D%A2%E8%AF%95%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93%E2%80%9D/" rel="next" title="“蓝队防守侧面试知识总结”">
                  “蓝队防守侧面试知识总结” <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wang deshan</span>
</div>
<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

-->

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/unitychan.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body>
</html>
